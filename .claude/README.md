# 自律CI修復エージェント

## 概要

このディレクトリには、ITSM-Systemの自律CI修復エージェント設定が含まれています。

## ファイル構成

- `hooks.json` - Hook設定ファイル（無限ループ防止機能付き）
- `auto-ci-repair-agent.sh` - 自律CI修復エージェントスクリプト
- `README.md` - このファイル

## 自律CI修復エージェントの仕様

### 目的

- `pnpm test:ci`を自動実行
- エラーを自動検知
- 原因を解析
- コードを安全に修正
- 最大15回まで自動修復を試行

### 実行フロー

```
1. pnpm test:ci 実行
2. エラー検知
3. 原因解析
4. 安全な修正適用
5. 再テスト実行
6. 成功判定 or 次の試行
```

### 制約

- ✅ CI/テスト/ソースコード修正に限定
- ❌ 本番環境・本番データの変更禁止
- ❌ 削除系コマンド禁止
- ⚠️ 設計変更が必要な場合は「人間判断」として整理

### 終了条件

エージェントは以下の条件で自動終了します：

1. **正常終了**: エラーが検知されず、全テストが成功
2. **最大試行到達**: 15回の試行を完了
3. **人間判断必要**: 設計変更が必要な問題を検出

### 出力形式

各試行の開始時：
```
Attempt X/15
```

成功時の出力：
```
✅ すべてのテストが安定して成功しました

💡 スラッシュコマンド実行案:
  - /commit "修正内容"
  - /push

🚀 次の開発ステップ:
  - セキュリティダッシュボード実装
  - レポート機能完成
  - アーキテクチャ改善

📋 要約レポート:
  実施内容: Attempt X で全テスト成功
  残課題: なし
```

### 15回失敗後の動作

15回の試行で修復できなかった場合：

1. 原因を分類して整理
2. 「人間判断が必要な残課題」としてリスト化
3. 30分後に自動再試行（別プロセス）
4. 30分間隔で継続実行

### 使用方法

#### 手動実行

```bash
./.claude/auto-ci-repair-agent.sh
```

#### Hook経由での実行

Hook設定（`hooks.json`）で`enabled: true`に設定すると、Stop hook経由で自動実行されます。

**注意**: 無限ループを防ぐため、デフォルトでは`enabled: false`に設定されています。

### トラブルシューティング

#### Stop hookが無限ループする場合

1. `hooks.json`の`enabled`を`false`に設定
2. セッションを再起動
3. 必要に応じて手動でスクリプトを実行

#### エージェントが終了しない場合

- Ctrl+C で強制終了
- Hook設定の`terminationConditions`を確認

## 技術スタック

- **パッケージマネージャー**: pnpm（npm経由）
- **テストフレームワーク**: Jest
- **リント**: ESLint + Prettier
- **CI/CD**: GitHub Actions + Auto Healing CI Loop

## 更新履歴

- 2025-12-29: 初版作成（無限ループ防止機能追加）
