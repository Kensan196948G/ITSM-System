# E2E確認シナリオ（ユーザー設定）

## 前提
- Linux 上で `python3` が利用可能
- `webui-sample` ディレクトリで作業
- 必要に応じて `POST /api/test/reset` で初期データへ戻せる

## 起動
1. `python3 api_server.py`
2. 起動ログに表示された自動割り当てIP（例: `http://192.168.0.185:8765`）を開く
3. ログイン画面で `ログインして開始`

## シナリオ
1. `システム設定` を開く
2. `ユーザー設定` テーブルが表示されることを確認
3. 検索欄に `yamada` を入力し、対象ユーザーが絞り込まれることを確認
4. `ロール` / `状態` / `部署` フィルタを切り替え、表示件数が変化することを確認
5. `ユーザー設定` テーブルのヘッダ（ID/ユーザー/部署/ロール/状態）をクリックし、昇順/降順で並び替わることを確認
6. ページサイズを `5件/頁` / `10件/頁` に切り替え、表示件数とページ番号が変わることを確認
7. `前へ` / `次へ` / ページ番号ボタンでページ移動できることを確認（データ件数に応じて）
8. `新規ユーザー作成` を押下
9. 以下を入力して `作成`
   - ユーザーID: `qa.user`
   - 表示名: `QA テスト`
   - 部署: `品質保証`
   - メール: `qa.user@example.local`
   - ロール権限: `サービスデスク`
   - 状態: `有効`
10. ユーザー一覧に `qa.user` が追加されることを確認
11. 追加したユーザーの `編集` を押下し、ロールを `SecOps` に変更して `更新`
12. 一覧に変更内容が反映されることを確認
13. 追加したユーザーの `削除` を押下して `削除`
14. 一覧から対象ユーザーが消えることを確認
15. `ロール権限マトリクス` の `閲覧範囲 (scope)` を変更し、任意の権限チェックを変更して `権限マトリクス保存`
16. `ユーザー設定監査ログ` に操作ログが追加されることを確認
17. ダッシュボードへ戻り、運用アクティビティにも監査ログ更新が反映されることを確認

## バリデーション確認
1. `新規ユーザー作成` を開く
2. ユーザーIDを空欄にして `作成`
3. `ユーザーID` 項目の直下にインラインエラーが表示されることを確認
4. メールアドレスを不正形式（例: `badmail`）にして `作成`
5. `メール` 項目の直下にインラインエラーが表示されることを確認
6. エラー項目を修正するとインラインエラーが消えることを確認

## API永続化確認（任意）
1. `webui-sample/data/users.json` を確認し、作成/編集/削除の結果が反映されることを確認
2. `webui-sample/data/roles.json` を確認し、ロール権限更新が反映されることを確認
3. `webui-sample/data/audit.json` を確認し、監査ログが追記されることを確認
4. `webui-sample/data/audit.json` のユーザー更新/ロール権限更新イベントに `before` / `after` が含まれることを確認
