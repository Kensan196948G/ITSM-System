<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ITSM-Sec Nexus | ISO 20000 & NIST CSF 2.0</title>
    <link rel="stylesheet" href="style.css?v=2.7">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./assets/fontawesome/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
</head>

<body>
    <!-- Login Screen -->
    <div id="login-screen" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <div class="logo-icon-large">
                    <i class="fas fa-shield-halved"></i>
                </div>
                <h1>ITSM-Sec Nexus</h1>
                <p>ISO 20000 & NIST CSF 2.0 統合管理システム</p>
            </div>
            <form id="login-form" class="login-form">
                <div class="form-group">
                    <label for="username">ユーザー名</label>
                    <input type="text" id="username" name="username" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label for="password">パスワード</label>
                    <input type="password" id="password" name="password" required autocomplete="current-password">
                </div>
                <div id="login-error" class="error-message" style="display: none;"></div>
                <button type="submit" class="btn-login">
                    <i class="fas fa-sign-in-alt"></i> ログイン
                </button>
            </form>
            <div class="login-footer">
                <a href="#" id="forgot-password-link" class="forgot-password-link">パスワードを忘れた場合</a>
                <p class="text-muted">デフォルトユーザー: admin / admin123</p>
            </div>
        </div>
    </div>

    <!-- Forgot Password Screen -->
    <div id="forgot-password-screen" class="login-container" style="display: none;">
        <div class="login-card">
            <div class="login-header">
                <div class="logo-icon-large">
                    <i class="fas fa-key"></i>
                </div>
                <h1>パスワードリセット</h1>
                <p>登録されたメールアドレスにリセットリンクを送信します</p>
            </div>
            <form id="forgot-password-form" class="login-form">
                <div class="form-group">
                    <label for="reset-email">メールアドレス</label>
                    <input type="email" id="reset-email" name="email" required autocomplete="email"
                           placeholder="your-email@example.com">
                </div>
                <div id="forgot-password-error" class="error-message" style="display: none;"></div>
                <div id="forgot-password-success" class="success-message" style="display: none;"></div>
                <button type="submit" class="btn-login">
                    <i class="fas fa-paper-plane"></i> リセットリンクを送信
                </button>
            </form>
            <div class="login-footer">
                <a href="#" id="back-to-login" class="forgot-password-link">
                    <i class="fas fa-arrow-left"></i> ログイン画面に戻る
                </a>
            </div>
        </div>
    </div>

    <!-- Reset Password Screen -->
    <div id="reset-password-screen" class="login-container" style="display: none;">
        <div class="login-card">
            <div class="login-header">
                <div class="logo-icon-large">
                    <i class="fas fa-lock-open"></i>
                </div>
                <h1>新しいパスワードを設定</h1>
                <p>新しいパスワードを入力してください</p>
            </div>
            <form id="reset-password-form" class="login-form">
                <input type="hidden" id="reset-token" name="token">
                <div class="form-group">
                    <label for="new-password">新しいパスワード</label>
                    <input type="password" id="new-password" name="new_password" required
                           minlength="8" autocomplete="new-password"
                           placeholder="8文字以上">
                </div>
                <div class="form-group">
                    <label for="confirm-password">パスワード確認</label>
                    <input type="password" id="confirm-password" name="confirm_password" required
                           minlength="8" autocomplete="new-password"
                           placeholder="もう一度入力">
                </div>
                <div id="reset-password-error" class="error-message" style="display: none;"></div>
                <div id="reset-password-success" class="success-message" style="display: none;"></div>
                <button type="submit" class="btn-login">
                    <i class="fas fa-check"></i> パスワードを変更
                </button>
            </form>
            <div class="login-footer">
                <a href="#" id="back-to-login-from-reset" class="forgot-password-link">
                    <i class="fas fa-arrow-left"></i> ログイン画面に戻る
                </a>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="app-container" class="app-container" style="display: none;">
        <!-- Sidebar Overlay (Mobile) -->
        <div id="sidebar-overlay" class="sidebar-overlay"></div>

        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="logo">
                <div class="logo-icon"></div>
                <span class="logo-text">ITSM System</span>
            </div>

            <nav class="nav-group">
                <span class="nav-label">General</span>
                <a href="#" class="nav-item active" data-view="dash">
                    <i class="fas fa-chart-line"></i>
                    <span>ダッシュボード</span>
                </a>
            </nav>

            <nav class="nav-group">
                <span class="nav-label">Operation (ISO 20000)</span>
                <a href="#" class="nav-item" data-view="incidents">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>インシデント管理</span>
                </a>
                <a href="#" class="nav-item" data-view="problems">
                    <i class="fas fa-brain"></i>
                    <span>問題管理</span>
                </a>
                <a href="#" class="nav-item" data-view="changes">
                    <i class="fas fa-sync-alt"></i>
                    <span>変更管理</span>
                </a>
                <a href="#" class="nav-item" data-view="releases">
                    <i class="fas fa-rocket"></i>
                    <span>リリース管理</span>
                </a>
                <a href="#" class="nav-item" data-view="requests">
                    <i class="fas fa-hand-holding-heart"></i>
                    <span>サービス要求管理</span>
                </a>
                <a href="#" class="nav-item" data-view="cmdb">
                    <i class="fas fa-database"></i>
                    <span>構成管理 (CMDB)</span>
                </a>
            </nav>

            <nav class="nav-group">
                <span class="nav-label">Governance & Strategy</span>
                <a href="#" class="nav-item" data-view="sla">
                    <i class="fas fa-file-contract"></i>
                    <span>SLA管理</span>
                </a>
                <a href="#" class="nav-item" data-view="knowledge">
                    <i class="fas fa-book"></i>
                    <span>ナレッジ管理</span>
                </a>
                <a href="#" class="nav-item" data-view="capacity">
                    <i class="fas fa-server"></i>
                    <span>キャパシティ管理</span>
                </a>
            </nav>

            <nav class="nav-group">
                <span class="nav-label">Security (NIST CSF 2.0)</span>
                <a href="#" class="nav-item" data-view="security-dashboard">
                    <i class="fas fa-shield-alt"></i>
                    <span>セキュリティダッシュボード</span>
                </a>
                <a href="#" class="nav-item" data-view="security">
                    <i class="fas fa-bug"></i>
                    <span>脆弱性管理</span>
                </a>
                <a href="#" class="nav-item" data-view="security-management">
                    <i class="fas fa-lock"></i>
                    <span>セキュリティ管理</span>
                </a>
            </nav>

            <nav class="nav-group">
                <span class="nav-label">Compliance</span>
                <a href="#" class="nav-item" data-view="audit-dashboard">
                    <i class="fas fa-chart-line"></i>
                    <span>監査ダッシュボード</span>
                </a>
                <a href="#" class="nav-item" data-view="audit-logs">
                    <i class="fas fa-file-alt"></i>
                    <span>監査ログ</span>
                </a>
                <a href="#" class="nav-item" data-view="compliance-policies">
                    <i class="fas fa-book"></i>
                    <span>ポリシー・プロシージャ管理</span>
                </a>
                <a href="#" class="nav-item" data-view="compliance-management">
                    <i class="fas fa-clipboard-check"></i>
                    <span>コンプライアンス管理</span>
                </a>
            </nav>

            <nav class="nav-group">
                <span class="nav-label">Settings</span>
                <a href="#" class="nav-item" data-view="user-settings">
                    <i class="fas fa-user-cog"></i>
                    <span>ユーザー設定</span>
                </a>
            </nav>

            <nav class="nav-group">
                <span class="nav-label">System Configuration</span>
                <a href="#" class="nav-item" data-view="settings_general">
                    <i class="fas fa-cog"></i>
                    <span>システム基本設定</span>
                </a>
                <a href="#" class="nav-item" data-view="settings_users">
                    <i class="fas fa-users-cog"></i>
                    <span>ユーザー・権限管理</span>
                </a>
                <a href="#" class="nav-item" data-view="settings_notifications">
                    <i class="fas fa-bell"></i>
                    <span>通知・アラート設定</span>
                </a>
            </nav>

            <!-- Logout Button -->
            <div class="sidebar-footer">
                <button id="logout-btn" class="btn-logout">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>ログアウト</span>
                </button>
                <div class="user-info">
                    <i class="fas fa-user-circle"></i>
                    <span id="current-user"></span>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="header">
                <div class="header-left">
                    <button id="sidebar-toggle" class="sidebar-toggle" aria-label="メニュー">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h2 id="section-title">統合ダッシュボード</h2>
                </div>
                <div class="header-right">
                    <div class="badge badge-info">
                        <i class="fas fa-sync fa-spin"></i> Live Monitoring
                    </div>
                </div>
            </header>

            <div class="content-area" id="main-view">
                <!-- Content will be dynamically loaded here by app.js -->
            </div>
        </main>
    </div>

    <!-- Modal Container -->
    <div id="modal-overlay" class="modal-overlay" style="display: none;">
        <div id="modal-container" class="modal-container">
            <div class="modal-header">
                <h3 id="modal-title"></h3>
                <button id="modal-close" class="modal-close-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Dynamic content will be inserted here -->
            </div>
            <div class="modal-footer" id="modal-footer">
                <!-- Dynamic buttons will be inserted here -->
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <script src="./utils/tableUtils.js"></script>
    <script src="app.js?v=4.4"></script>
</body>

</html>
