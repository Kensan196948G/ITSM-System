# ITSM-Sec Nexus - é–‹ç™ºç’°å¢ƒãƒ»æœ¬ç•ªç’°å¢ƒ åˆ†é›¢é‹ç”¨ã‚¬ã‚¤ãƒ‰

## ğŸ“‹ ç›®æ¬¡

1. [ç’°å¢ƒæ§‹æˆã®æ¦‚è¦](#ç’°å¢ƒæ§‹æˆã®æ¦‚è¦)
2. [é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼](#é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼)
3. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†](#ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†)
4. [è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†](#è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†)
5. [ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ—ãƒ­ã‚»ã‚¹](#ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ—ãƒ­ã‚»ã‚¹)
6. [ãƒ­ã‚°ç®¡ç†ã¨ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°](#ãƒ­ã‚°ç®¡ç†ã¨ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°)
7. [ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æˆ¦ç•¥](#ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æˆ¦ç•¥)
8. [ãƒãƒ¼ãƒ é–‹ç™º](#ãƒãƒ¼ãƒ é–‹ç™º)
9. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)

---

## ç’°å¢ƒæ§‹æˆã®æ¦‚è¦

### ğŸŒ ç’°å¢ƒãƒãƒˆãƒªãƒƒã‚¯ã‚¹

| ç’°å¢ƒ | URL | ãƒãƒ¼ãƒˆ | ãƒ—ãƒ­ãƒˆã‚³ãƒ« | NODE_ENV | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ | ç”¨é€” |
|------|-----|--------|-----------|----------|------------|------|
| **é–‹ç™ºç’°å¢ƒ** | `https://192.168.0.187:5443` | 5443 | HTTPS | development | itsm_nexus.db | æ©Ÿèƒ½é–‹ç™ºãƒ»ãƒ‡ãƒãƒƒã‚° |
| **æœ¬ç•ªç’°å¢ƒ** | `https://192.168.0.187:6443` | 6443 | HTTPS | production | itsm_nexus.db | å®Ÿé‹ç”¨ |

### ğŸ¯ ç’°å¢ƒåˆ†é›¢ã®ç›®çš„

âœ… **é–‹ç™ºã¨æœ¬ç•ªã®å®Œå…¨åˆ†é›¢**
- æœ¬ç•ªç’°å¢ƒã‚’å£Šã™ãƒªã‚¹ã‚¯ã‚¼ãƒ­
- è‡ªç”±ãªå®Ÿé¨“ãŒå¯èƒ½

âœ… **è¦–è¦šçš„ãªç’°å¢ƒè­˜åˆ¥**
- é–‹ç™ºç’°å¢ƒ: ç·‘è‰²ãƒãƒƒã‚¸ `ğŸ”§ é–‹ç™ºç’°å¢ƒ`
- æœ¬ç•ªç’°å¢ƒ: èµ¤è‰²ãƒãƒƒã‚¸ `ğŸ”’ æœ¬ç•ªç’°å¢ƒ`
- ãƒ–ãƒ©ã‚¦ã‚¶ã‚¿ãƒ–: `[é–‹ç™º]` / `[æœ¬ç•ª]`

âœ… **ç‹¬ç«‹ã—ãŸã‚µãƒ¼ãƒ“ã‚¹ç®¡ç†**
- ç‰‡æ–¹ã ã‘ã‚’èµ·å‹•/åœæ­¢å¯èƒ½
- ç•°ãªã‚‹ãƒªã‚½ãƒ¼ã‚¹åˆ¶é™
- åˆ¥ã€…ã®ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«

---

## é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### ğŸ”„ åŸºæœ¬ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ©Ÿèƒ½é–‹ç™º    â”‚  é–‹ç™ºç’°å¢ƒã§æ–°æ©Ÿèƒ½ã‚’å®Ÿè£…
â”‚  (Dev)      â”‚  https://192.168.0.187:5443
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ†ã‚¹ãƒˆ      â”‚  é–‹ç™ºç’°å¢ƒã§å‹•ä½œç¢ºèª
â”‚  (Dev)      â”‚  ãƒ»æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  ãƒ»UIãƒ†ã‚¹ãƒˆ
       â”‚         ãƒ»çµ±åˆãƒ†ã‚¹ãƒˆ
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã‚³ãƒŸãƒƒãƒˆ     â”‚  Gitã«ã‚³ãƒŸãƒƒãƒˆ
â”‚ (Git)       â”‚  git commit -m "..."
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ‡ãƒ—ãƒ­ã‚¤    â”‚  æœ¬ç•ªç’°å¢ƒã«åæ˜ 
â”‚  (Prod)     â”‚  æœ¬ç•ªã‚µãƒ¼ãƒ“ã‚¹ã‚’å†èµ·å‹•
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¤œè¨¼ãƒ»ç›£è¦–   â”‚  æœ¬ç•ªç’°å¢ƒã§å‹•ä½œç¢ºèª
â”‚  (Prod)     â”‚  ãƒ­ã‚°ç›£è¦–
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“ æ—¥å¸¸çš„ãªé–‹ç™ºãƒ•ãƒ­ãƒ¼

#### **ã‚¹ãƒ†ãƒƒãƒ—1: é–‹ç™ºç’°å¢ƒã§ä½œæ¥­**

```bash
# é–‹ç™ºç’°å¢ƒã®ã¿èµ·å‹•
sudo ./manage-env.sh prod stop
sudo ./manage-env.sh dev start

# ãƒ­ã‚°ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–
./manage-env.sh dev logs
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ãï¼š
```
https://192.168.0.187:5443
```

#### **ã‚¹ãƒ†ãƒƒãƒ—2: ã‚³ãƒ¼ãƒ‰å¤‰æ›´**

```bash
# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ä¿®æ­£
nano frontend/app.js
nano frontend/style.css

# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ä¿®æ­£
nano backend/routes/incidents.js
nano backend/middleware/auth.js
```

#### **ã‚¹ãƒ†ãƒƒãƒ—3: é–‹ç™ºç’°å¢ƒã§å³åº§ã«ãƒ†ã‚¹ãƒˆ**

```bash
# é–‹ç™ºç’°å¢ƒã‚’å†èµ·å‹•
sudo ./manage-env.sh dev restart

# ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒ†ã‚¹ãƒˆ
# https://192.168.0.187:5443
```

#### **ã‚¹ãƒ†ãƒƒãƒ—4: ãƒ†ã‚¹ãƒˆãŒå®Œäº†ã—ãŸã‚‰ã‚³ãƒŸãƒƒãƒˆ**

```bash
git add .
git commit -m "feat: æ–°ã—ã„æ©Ÿèƒ½ã‚’è¿½åŠ "
```

#### **ã‚¹ãƒ†ãƒƒãƒ—5: æœ¬ç•ªç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤**

```bash
# æœ¬ç•ªç’°å¢ƒã‚’å†èµ·å‹•ã—ã¦å¤‰æ›´ã‚’åæ˜ 
sudo ./manage-env.sh prod restart

# æœ¬ç•ªç’°å¢ƒã§å‹•ä½œç¢ºèª
# https://192.168.0.187:6443
```

---

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†

### ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æˆ¦ç•¥

#### **ç¾åœ¨ã®æ§‹æˆ**

- **å…±é€šãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: `backend/itsm_nexus.db`
- ä¸¡ç’°å¢ƒãŒåŒã˜DBã‚’å‚ç…§

#### **æ¨å¥¨æ§‹æˆï¼ˆå°†æ¥ï¼‰**

```
backend/
  â”œâ”€â”€ itsm_nexus_dev.db      # é–‹ç™ºç’°å¢ƒå°‚ç”¨
  â””â”€â”€ itsm_nexus_prod.db     # æœ¬ç•ªç’°å¢ƒå°‚ç”¨
```

### ğŸ“‹ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆ†é›¢ã®å®Ÿè£…

#### **1. ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°**

`.env.development`:
```bash
DATABASE_PATH=./backend/itsm_nexus_dev.db
```

`.env.production`:
```bash
DATABASE_PATH=./backend/itsm_nexus_prod.db
```

#### **2. é–‹ç™ºç”¨DBã‚’ä½œæˆ**

```bash
# æœ¬ç•ªDBã‚’ã‚³ãƒ”ãƒ¼ã—ã¦é–‹ç™ºDBã‚’ä½œæˆ
cp backend/itsm_nexus.db backend/itsm_nexus_dev.db

# ã¾ãŸã¯ã€ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰æ–°è¦ä½œæˆ
cd backend
node -e "require('./db').initDb()"
```

#### **3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**

```bash
#!/bin/bash
# backup-db.sh

DATE=$(date +%Y%m%d_%H%M%S)

# æœ¬ç•ªDBã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
cp backend/itsm_nexus.db "backups/itsm_nexus_prod_${DATE}.db"

# é–‹ç™ºDBã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆé€±æ¬¡ï¼‰
if [ $(date +%u) -eq 1 ]; then
    cp backend/itsm_nexus_dev.db "backups/itsm_nexus_dev_${DATE}.db"
fi

# 30æ—¥ä»¥ä¸Šå¤ã„ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å‰Šé™¤
find backups/ -name "*.db" -mtime +30 -delete

echo "âœ… ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Œäº†: ${DATE}"
```

### ğŸ”„ æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ã‚’é–‹ç™ºç’°å¢ƒã«åŒæœŸ

```bash
# æœ¬ç•ªDBã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’å–å¾—
cp backend/itsm_nexus.db "backups/itsm_nexus_$(date +%Y%m%d).db"

# é–‹ç™ºDBã«ä¸Šæ›¸ãï¼ˆæ³¨æ„ï¼šé–‹ç™ºãƒ‡ãƒ¼ã‚¿ã¯å¤±ã‚ã‚Œã¾ã™ï¼‰
cp backend/itsm_nexus.db backend/itsm_nexus_dev.db

# é–‹ç™ºç’°å¢ƒã‚’å†èµ·å‹•
sudo ./manage-env.sh dev restart
```

---

## è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†

### ğŸ“ ç’°å¢ƒåˆ¥è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | èª¬æ˜ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç† |
|---------|------|--------------|
| `.env.development` | é–‹ç™ºç’°å¢ƒè¨­å®š | âœ… Gitã«ã‚³ãƒŸãƒƒãƒˆ |
| `.env.production` | æœ¬ç•ªç’°å¢ƒè¨­å®š | âš ï¸ .gitignoreã«è¿½åŠ  |
| `.env.example` | è¨­å®šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ | âœ… Gitã«ã‚³ãƒŸãƒƒãƒˆ |

### ğŸ”’ æ©Ÿå¯†æƒ…å ±ã®ç®¡ç†

#### **æ¨å¥¨äº‹é …**

1. **.gitignoreã«è¿½åŠ **

```bash
# .gitignore
.env.production
*.db
*.db-wal
*.db-shm
backend-*.log
ssl/*.key
```

2. **æœ¬ç•ªç’°å¢ƒã®æ©Ÿå¯†æƒ…å ±**

```bash
# .env.production ã¯æ‰‹å‹•ã§ç®¡ç†
# ä»¥ä¸‹ã®æƒ…å ±ã¯çµ¶å¯¾ã«Gitã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„ï¼š
- JWT_SECRETï¼ˆæœ¬ç•ªç”¨ï¼‰
- SMTP_PASSWORD
- M365_CLIENT_SECRET
- SSLç§˜å¯†éµ
```

3. **ç’°å¢ƒå¤‰æ•°ã®æ¤œè¨¼**

```bash
# èµ·å‹•æ™‚ã«å¿…é ˆç’°å¢ƒå¤‰æ•°ã‚’ãƒã‚§ãƒƒã‚¯
node -e "
if (!process.env.JWT_SECRET) {
  console.error('âŒ JWT_SECRET ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“');
  process.exit(1);
}
console.log('âœ… ç’°å¢ƒå¤‰æ•°ãƒã‚§ãƒƒã‚¯å®Œäº†');
"
```

---

## ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ—ãƒ­ã‚»ã‚¹

### ğŸš€ é–‹ç™ºâ†’æœ¬ç•ªã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

#### **ãƒ‘ã‚¿ãƒ¼ãƒ³1: å°è¦æ¨¡ãªå¤‰æ›´ï¼ˆæ¨å¥¨ï¼‰**

```bash
# 1. é–‹ç™ºç’°å¢ƒã§ãƒ†ã‚¹ãƒˆæ¸ˆã¿ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
./manage-env.sh dev status

# 2. Gitã«ã‚³ãƒŸãƒƒãƒˆ
git add frontend/app.js backend/routes/incidents.js
git commit -m "fix: ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆç®¡ç†ã®è¡¨ç¤ºãƒã‚°ã‚’ä¿®æ­£"

# 3. æœ¬ç•ªç’°å¢ƒã‚’å†èµ·å‹•
sudo ./manage-env.sh prod restart

# 4. æœ¬ç•ªç’°å¢ƒã§å‹•ä½œç¢ºèª
# https://192.168.0.187:6443

# 5. ãƒ­ã‚°ã‚’ç›£è¦–
./manage-env.sh prod logs
```

#### **ãƒ‘ã‚¿ãƒ¼ãƒ³2: å¤§è¦æ¨¡ãªå¤‰æ›´**

```bash
# 1. æœ¬ç•ªDBã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
cp backend/itsm_nexus.db "backups/itsm_nexus_$(date +%Y%m%d_%H%M%S).db"

# 2. æœ¬ç•ªç’°å¢ƒã‚’åœæ­¢
sudo ./manage-env.sh prod stop

# 3. DBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œï¼ˆå¿…è¦ãªå ´åˆï¼‰
cd backend
npm run migrate

# 4. æœ¬ç•ªç’°å¢ƒã‚’èµ·å‹•
sudo ./manage-env.sh prod start

# 5. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl -k https://192.168.0.187:6443/health

# 6. ç›£è¦–
./manage-env.sh prod logs
```

#### **ãƒ‘ã‚¿ãƒ¼ãƒ³3: ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯**

```bash
# 1. æœ¬ç•ªç’°å¢ƒã‚’åœæ­¢
sudo ./manage-env.sh prod stop

# 2. ä»¥å‰ã®ã‚³ãƒŸãƒƒãƒˆã«æˆ»ã‚‹
git log --oneline -10
git checkout <commit-hash>

# 3. DBã‚’å¾©å…ƒï¼ˆå¿…è¦ãªå ´åˆï¼‰
cp backups/itsm_nexus_20260116_100000.db backend/itsm_nexus.db

# 4. æœ¬ç•ªç’°å¢ƒã‚’èµ·å‹•
sudo ./manage-env.sh prod start
```

---

## ãƒ­ã‚°ç®¡ç†ã¨ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

### ğŸ“Š ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«

| ç’°å¢ƒ | ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ« | å ´æ‰€ |
|------|------------|------|
| é–‹ç™ºç’°å¢ƒ | `backend-dev.log` | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆ |
| æœ¬ç•ªç’°å¢ƒ | `backend-prod.log` | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆ |

### ğŸ” ãƒ­ã‚°ç›£è¦–ã‚³ãƒãƒ³ãƒ‰

```bash
# é–‹ç™ºç’°å¢ƒã®ãƒ­ã‚°ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º
tail -f backend-dev.log

# æœ¬ç•ªç’°å¢ƒã®ãƒ­ã‚°ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º
tail -f backend-prod.log

# ã‚¨ãƒ©ãƒ¼ã®ã¿æŠ½å‡º
grep -i "error\|failed\|exception" backend-prod.log

# éå»1æ™‚é–“ã®ãƒ­ã‚°
journalctl -u itsm-sec-nexus-prod --since "1 hour ago"
```

### ğŸ“ˆ ç›£è¦–ã™ã¹ãé …ç›®

#### **é–‹ç™ºç’°å¢ƒ**

- JavaScriptã‚¨ãƒ©ãƒ¼
- APIå¿œç­”æ™‚é–“
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªæ€§èƒ½

#### **æœ¬ç•ªç’°å¢ƒ**

- ã‚µãƒ¼ãƒ“ã‚¹ç¨¼åƒç‡
- ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿç‡
- APIå¿œç­”æ™‚é–“
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡
- CPUä½¿ç”¨ç‡
- èªè¨¼å¤±æ•—å›æ•°

### ğŸ”” ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®šï¼ˆæ¨å¥¨ï¼‰

```bash
# æœ¬ç•ªç’°å¢ƒã®ã‚¨ãƒ©ãƒ¼ã‚’ç›£è¦–ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
# watch-prod-errors.sh

#!/bin/bash
tail -f backend-prod.log | while read line; do
    if echo "$line" | grep -qi "error\|failed\|exception"; then
        # é€šçŸ¥ã‚’é€ä¿¡ï¼ˆä¾‹ï¼šSlackã€ãƒ¡ãƒ¼ãƒ«ï¼‰
        echo "ğŸš¨ æœ¬ç•ªç’°å¢ƒã§ã‚¨ãƒ©ãƒ¼æ¤œå‡º: $line"
        # curl -X POST <webhook-url> -d "..."
    fi
done
```

---

## ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æˆ¦ç•¥

### ğŸ’¾ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è¨ˆç”»

| å¯¾è±¡ | é »åº¦ | ä¿æŒæœŸé–“ | æ–¹æ³• |
|------|------|---------|------|
| **æœ¬ç•ªDB** | æ¯æ—¥ | 30æ—¥ | è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— |
| **é–‹ç™ºDB** | é€±æ¬¡ | 7æ—¥ | è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— |
| **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«** | å¤‰æ›´æ™‚ | Gitå±¥æ­´ | Gitã‚³ãƒŸãƒƒãƒˆ |
| **SSLè¨¼æ˜æ›¸** | æ›´æ–°æ™‚ | æ°¸ä¹… | æ‰‹å‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— |

### ğŸ“ è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```bash
#!/bin/bash
# daily-backup.sh

BACKUP_DIR="/mnt/LinuxHDD/ITSM-System/backups"
DATE=$(date +%Y%m%d_%H%M%S)

mkdir -p "$BACKUP_DIR"

# æœ¬ç•ªDBã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
cp backend/itsm_nexus.db "${BACKUP_DIR}/itsm_nexus_prod_${DATE}.db"

# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
cp .env.production "${BACKUP_DIR}/.env.production_${DATE}.bak"

# åœ§ç¸®
tar -czf "${BACKUP_DIR}/backup_${DATE}.tar.gz" \
    backend/itsm_nexus.db \
    .env.production \
    ssl/

# 30æ—¥ä»¥ä¸Šå¤ã„ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å‰Šé™¤
find "$BACKUP_DIR" -name "*.db" -mtime +30 -delete
find "$BACKUP_DIR" -name "*.tar.gz" -mtime +30 -delete

echo "âœ… ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Œäº†: ${DATE}"
```

### â° cronã§è‡ªå‹•å®Ÿè¡Œ

```bash
# crontabã«è¿½åŠ 
crontab -e

# æ¯æ—¥åˆå‰3æ™‚ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
0 3 * * * /mnt/LinuxHDD/ITSM-System/daily-backup.sh >> /mnt/LinuxHDD/ITSM-System/backup.log 2>&1
```

---

## ãƒãƒ¼ãƒ é–‹ç™º

### ğŸ‘¥ å½¹å‰²åˆ†æ‹…

| å½¹å‰² | ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ | ä¸»ãªä½œæ¥­ |
|------|------------|---------|
| **é–‹ç™ºè€…** | é–‹ç™ºç’°å¢ƒ | æ©Ÿèƒ½å®Ÿè£…ã€ãƒã‚°ä¿®æ­£ |
| **ãƒ†ã‚¹ã‚¿ãƒ¼** | é–‹ç™ºç’°å¢ƒ | QAã€ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å®Ÿè¡Œ |
| **ç®¡ç†è€…** | ä¸¡ç’°å¢ƒ | ãƒ‡ãƒ—ãƒ­ã‚¤ã€è¨­å®šå¤‰æ›´ |
| **é‹ç”¨æ‹…å½“** | æœ¬ç•ªç’°å¢ƒï¼ˆèª­ã¿å–ã‚Šï¼‰ | ç›£è¦–ã€ãƒ­ã‚°ç¢ºèª |

### ğŸ”€ ãƒ–ãƒ©ãƒ³ãƒæˆ¦ç•¥

```
main (æœ¬ç•ªç’°å¢ƒ)
  â”‚
  â”œâ”€â”€ develop (é–‹ç™ºç’°å¢ƒ)
  â”‚     â”‚
  â”‚     â”œâ”€â”€ feature/incident-filter
  â”‚     â”œâ”€â”€ feature/sla-dashboard
  â”‚     â””â”€â”€ bugfix/authentication
  â”‚
  â””â”€â”€ hotfix/security-patch (ç·Šæ€¥ä¿®æ­£)
```

#### **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼**

```bash
# 1. æ–°æ©Ÿèƒ½ã®é–‹ç™º
git checkout -b feature/new-feature develop
# é–‹ç™ºç’°å¢ƒã§ä½œæ¥­
# https://192.168.0.187:5443

# 2. é–‹ç™ºãƒ–ãƒ©ãƒ³ãƒã«ãƒãƒ¼ã‚¸
git checkout develop
git merge feature/new-feature

# 3. é–‹ç™ºç’°å¢ƒã§ãƒ†ã‚¹ãƒˆ
sudo ./manage-env.sh dev restart

# 4. æœ¬ç•ªã«ãƒãƒ¼ã‚¸
git checkout main
git merge develop

# 5. æœ¬ç•ªç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤
sudo ./manage-env.sh prod restart
```

### ğŸ“‹ ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹

1. **ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆ**
2. **é–‹ç™ºç’°å¢ƒã§å‹•ä½œç¢ºèª**
3. **ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼**
4. **ãƒãƒ¼ã‚¸**
5. **æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤**

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ğŸ”§ ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºç­–

#### **å•é¡Œ1: é–‹ç™ºç’°å¢ƒã¨æœ¬ç•ªç’°å¢ƒã§æŒ™å‹•ãŒé•ã†**

**åŸå› **: ç’°å¢ƒå¤‰æ•°ã®é•ã„

**è§£æ±º**:
```bash
# ç’°å¢ƒå¤‰æ•°ã®å·®åˆ†ã‚’ç¢ºèª
diff .env.development .env.production

# ç‰¹ã«ä»¥ä¸‹ã‚’ãƒã‚§ãƒƒã‚¯ï¼š
- NODE_ENV
- LOG_LEVEL
- RATE_LIMITè¨­å®š
- CORS_ORIGIN
```

#### **å•é¡Œ2: æœ¬ç•ªç’°å¢ƒã§ã‚¨ãƒ©ãƒ¼ãŒé »ç™º**

**è§£æ±º**:
```bash
# ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ç¢ºèª
tail -100 backend-prod.log | grep -i error

# ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨çŠ¶æ³ã‚’ç¢ºèª
./manage-env.sh prod status

# å¿…è¦ã«å¿œã˜ã¦ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
git checkout <previous-commit>
sudo ./manage-env.sh prod restart
```

#### **å•é¡Œ3: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒå£Šã‚ŒãŸ**

**è§£æ±º**:
```bash
# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰å¾©å…ƒ
cp backups/itsm_nexus_prod_<DATE>.db backend/itsm_nexus.db

# ã‚µãƒ¼ãƒ“ã‚¹ã‚’å†èµ·å‹•
sudo ./manage-env.sh prod restart
```

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### ğŸ” é–‹ç™ºç’°å¢ƒ

- âœ… ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã®ä½¿ç”¨OK
- âœ… ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°æœ‰åŠ¹
- âš ï¸ æœ¬ç•ªã®æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã¯ä½¿ç”¨ã—ãªã„

### ğŸ”’ æœ¬ç•ªç’°å¢ƒ

- âŒ ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ç„¡åŠ¹
- âŒ ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ç„¡åŠ¹
- âœ… å¼·åŠ›ãªJWT_SECRET
- âœ… ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚’å³ã—ãè¨­å®š
- âœ… å®šæœŸçš„ãªãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
- âœ… ãƒ­ã‚°ç›£è¦–

---

## ã‚¯ã‚¤ãƒƒã‚¯ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

### ğŸš€ ã‚ˆãä½¿ã†ã‚³ãƒãƒ³ãƒ‰

```bash
# é–‹ç™ºä½œæ¥­é–‹å§‹
sudo ./manage-env.sh dev start
./manage-env.sh dev logs

# é–‹ç™ºç’°å¢ƒã§ãƒ†ã‚¹ãƒˆ
sudo ./manage-env.sh dev restart

# æœ¬ç•ªã«ãƒ‡ãƒ—ãƒ­ã‚¤
sudo ./manage-env.sh prod restart

# ä¸¡æ–¹ã®çŠ¶æ…‹ã‚’ç¢ºèª
./manage-env.sh dev status
./manage-env.sh prod status

# ãƒ­ã‚°ã‚’ç¢ºèª
tail -f backend-dev.log
tail -f backend-prod.log
```

---

## ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **ç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**: `ENVIRONMENT_SETUP.md`
- **Systemdã‚µãƒ¼ãƒ“ã‚¹ç®¡ç†**: `SYSTEMD_SERVICE.md`
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ**: `DATABASE_DESIGN.md`
- **APIä»•æ§˜**: `openapi.yaml`

---

**ITSM-Sec Nexus Team**
