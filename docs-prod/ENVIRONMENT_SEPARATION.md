# ç’°å¢ƒåˆ†é›¢ã‚¬ã‚¤ãƒ‰ - ITSM-Sec Nexus

## ğŸ“‹ ç›®æ¬¡

- [æ¦‚è¦](#æ¦‚è¦)
- [ç’°å¢ƒåˆ†é›¢ã®è¨­è¨ˆæ€æƒ³](#ç’°å¢ƒåˆ†é›¢ã®è¨­è¨ˆæ€æƒ³)
- [ç’°å¢ƒæ§‹æˆ](#ç’°å¢ƒæ§‹æˆ)
- [ç’°å¢ƒåˆ‡ã‚Šæ›¿ãˆæ–¹æ³•](#ç’°å¢ƒåˆ‡ã‚Šæ›¿ãˆæ–¹æ³•)
- [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆ†é›¢](#ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆ†é›¢)
- [èª¤æ“ä½œé˜²æ­¢æ©Ÿæ§‹](#èª¤æ“ä½œé˜²æ­¢æ©Ÿæ§‹)
- [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)
- [ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹](#ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹)

---

## æ¦‚è¦

ITSM-Sec Nexusã¯ã€é–‹ç™ºç’°å¢ƒã¨æœ¬ç•ªç’°å¢ƒã‚’**å®Œå…¨ã«åˆ†é›¢**ã—ã¦é‹ç”¨ã™ã‚‹ã“ã¨ã§ã€ä»¥ä¸‹ã‚’å®Ÿç¾ã—ã¾ã™:

- **èª¤æ“ä½œã®é˜²æ­¢**: æœ¬ç•ªç’°å¢ƒã¸ã®æ„å›³ã—ãªã„å¤‰æ›´ã‚’é˜²ã
- **ãƒ‡ãƒ¼ã‚¿ä¿è­·**: é–‹ç™ºä½œæ¥­ãŒæœ¬ç•ªãƒ‡ãƒ¼ã‚¿ã«å½±éŸ¿ã—ãªã„ã‚ˆã†ä¿è¨¼
- **ä¸¦è¡Œç¨¼åƒ**: é–‹ç™ºã¨æœ¬ç•ªã‚’åŒæ™‚ã«ç¨¼åƒå¯èƒ½
- **å®‰å…¨ãªãƒ†ã‚¹ãƒˆ**: æœ¬ç•ªç’°å¢ƒã«å½±éŸ¿ã‚’ä¸ãˆãšã«æ–°æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆ

---

## ç’°å¢ƒåˆ†é›¢ã®è¨­è¨ˆæ€æƒ³

### å®Œå…¨åˆ†é›¢ã®3åŸå‰‡

1. **è¨­å®šã®åˆ†é›¢**
   - ç’°å¢ƒã”ã¨ã«ç‹¬ç«‹ã—ãŸ`.env`ãƒ•ã‚¡ã‚¤ãƒ«
   - ãƒãƒ¼ãƒˆç•ªå·ã®å®Œå…¨ãªåˆ†é›¢
   - JWT_SECRETã®ç’°å¢ƒåˆ¥ç®¡ç†

2. **ãƒ‡ãƒ¼ã‚¿ã®åˆ†é›¢**
   - ç’°å¢ƒã”ã¨ã«å°‚ç”¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«
   - ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®ç’°å¢ƒåˆ¥ç®¡ç†
   - ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®åˆ†é›¢

3. **å®Ÿè¡Œã®åˆ†é›¢**
   - systemdã‚µãƒ¼ãƒ“ã‚¹ã®ç‹¬ç«‹èµ·å‹•
   - ãƒ—ãƒ­ã‚»ã‚¹ã®å®Œå…¨ãªåˆ†é›¢
   - ãƒªã‚½ãƒ¼ã‚¹ç«¶åˆã®å›é¿

---

## ç’°å¢ƒæ§‹æˆ

### é–‹ç™ºç’°å¢ƒ (Development)

| é …ç›® | è¨­å®šå€¤ |
|------|--------|
| **NODE_ENV** | development |
| **HTTPSãƒãƒ¼ãƒˆ** | 5443 |
| **ã‚¢ã‚¯ã‚»ã‚¹URL** | https://192.168.0.187:5443 |
| **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹** | `backend/itsm_nexus_dev.db` |
| **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«** | `config/env/.env.development` |
| **JWT_SECRET** | é–‹ç™ºç”¨ï¼ˆçŸ­ã‚ã€å›ºå®šå€¤ã§ã‚‚å¯ï¼‰ |
| **ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«** | debug |
| **ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿** | æœ‰åŠ¹ |
| **Rate Limiting** | ç·©ã„ï¼ˆ1000 req/minï¼‰ |
| **systemdã‚µãƒ¼ãƒ“ã‚¹** | itsm-sec-nexus-dev |

**ç”¨é€”**: æ©Ÿèƒ½é–‹ç™ºã€ãƒ†ã‚¹ãƒˆã€ãƒ‡ãƒãƒƒã‚°

### æœ¬ç•ªç’°å¢ƒ (Production)

| é …ç›® | è¨­å®šå€¤ |
|------|--------|
| **NODE_ENV** | production |
| **HTTPSãƒãƒ¼ãƒˆ** | 6443 |
| **HTTPãƒãƒ¼ãƒˆ** | 8080 (é–‹ç™ºãƒ»ãƒ‡ãƒãƒƒã‚°ç”¨) |
| **ã‚¢ã‚¯ã‚»ã‚¹URL** | https://192.168.0.187:6443 |
| **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹** | `backend/itsm_nexus_prod.db` |
| **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«** | `config/env/.env.production` |
| **JWT_SECRET** | æœ¬ç•ªç”¨ï¼ˆå¼·åŠ›ã€ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆï¼‰ |
| **ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«** | info / warn |
| **ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿** | ç„¡åŠ¹ |
| **Rate Limiting** | å³ã—ã„ï¼ˆ100 req/minï¼‰ |
| **systemdã‚µãƒ¼ãƒ“ã‚¹** | itsm-sec-nexus-prod |

**ç”¨é€”**: å®Ÿé‹ç”¨ã€æœ¬ç•ªã‚µãƒ¼ãƒ“ã‚¹æä¾›

---

## ç’°å¢ƒåˆ‡ã‚Šæ›¿ãˆæ–¹æ³•

### åŸºæœ¬çš„ãªä½¿ã„æ–¹

```bash
# ç¾åœ¨ã®ç’°å¢ƒçŠ¶æ…‹ã‚’ç¢ºèª
./scripts/switch-env.sh status

# é–‹ç™ºç’°å¢ƒã«åˆ‡ã‚Šæ›¿ãˆ
./scripts/switch-env.sh dev

# æœ¬ç•ªç’°å¢ƒã«åˆ‡ã‚Šæ›¿ãˆï¼ˆç¢ºèªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚ã‚Šï¼‰
./scripts/switch-env.sh prod

# ãƒ˜ãƒ«ãƒ—ã‚’è¡¨ç¤º
./scripts/switch-env.sh help
```

### ç’°å¢ƒåˆ‡ã‚Šæ›¿ãˆã®æµã‚Œ

#### 1. é–‹ç™ºç’°å¢ƒã¸ã®åˆ‡ã‚Šæ›¿ãˆ

```bash
$ ./scripts/switch-env.sh dev
```

**å®Ÿè¡Œå†…å®¹:**
1. ç’°å¢ƒè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ¤œè¨¼
2. æœ¬ç•ªã‚µãƒ¼ãƒ“ã‚¹åœæ­¢ç¢ºèªï¼ˆå®Ÿè¡Œä¸­ã®å ´åˆï¼‰
3. `.env.development` â†’ `.env` ã¸ã‚³ãƒ”ãƒ¼
4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ `itsm_nexus_dev.db` ã«åˆ‡ã‚Šæ›¿ãˆ
5. ãƒ­ã‚°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
6. èµ·å‹•æƒ…å ±ã®è¡¨ç¤º

#### 2. æœ¬ç•ªç’°å¢ƒã¸ã®åˆ‡ã‚Šæ›¿ãˆ

```bash
$ ./scripts/switch-env.sh prod
```

**å®Ÿè¡Œå†…å®¹:**
1. æœ¬ç•ªè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ç¢ºèª
2. **ç¢ºèªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¡¨ç¤º**ï¼ˆ"yes"å…¥åŠ›ãŒå¿…è¦ï¼‰
3. é–‹ç™ºã‚µãƒ¼ãƒ“ã‚¹åœæ­¢ç¢ºèª
4. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**
5. `.env.production` â†’ `.env` ã¸ã‚³ãƒ”ãƒ¼
6. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ `itsm_nexus_prod.db` ã«åˆ‡ã‚Šæ›¿ãˆ
7. èµ·å‹•æƒ…å ±ã®è¡¨ç¤º

> **é‡è¦**: æœ¬ç•ªç’°å¢ƒã¸ã®åˆ‡ã‚Šæ›¿ãˆã«ã¯æ˜ç¤ºçš„ãª"yes"å…¥åŠ›ãŒå¿…è¦ã§ã™ã€‚ã“ã‚Œã¯èª¤æ“ä½œé˜²æ­¢ã®ãŸã‚ã®å®‰å…¨æ©Ÿæ§‹ã§ã™ã€‚

### ç’°å¢ƒã®èµ·å‹•

ç’°å¢ƒåˆ‡ã‚Šæ›¿ãˆå¾Œã€ã‚µãƒ¼ãƒ“ã‚¹ã‚’èµ·å‹•ã—ã¾ã™:

```bash
# é–‹ç™ºç’°å¢ƒã®èµ·å‹•
sudo systemctl start itsm-sec-nexus-dev

# æœ¬ç•ªç’°å¢ƒã®èµ·å‹•
sudo systemctl start itsm-sec-nexus-prod

# ä¸¡æ–¹ã®ç’°å¢ƒã‚’èµ·å‹•ï¼ˆä¸¦è¡Œç¨¼åƒï¼‰
sudo systemctl start itsm-sec-nexus-dev
sudo systemctl start itsm-sec-nexus-prod
```

### npmã‚³ãƒãƒ³ãƒ‰ã§ã®èµ·å‹•

```bash
# é–‹ç™ºç’°å¢ƒ
npm run dev:backend

# æœ¬ç•ªç’°å¢ƒ
NODE_ENV=production npm start
```

---

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆ†é›¢

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
backend/
â”œâ”€â”€ itsm_nexus.db          # ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ï¼ˆç¾åœ¨ã®ç’°å¢ƒï¼‰
â”œâ”€â”€ itsm_nexus_dev.db      # é–‹ç™ºç’°å¢ƒå°‚ç”¨
â”œâ”€â”€ itsm_nexus_prod.db     # æœ¬ç•ªç’°å¢ƒå°‚ç”¨
â”œâ”€â”€ itsm_nexus_dev.db-shm  # é–‹ç™ºç’°å¢ƒWALãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ itsm_nexus_dev.db-wal  # é–‹ç™ºç’°å¢ƒWALãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ itsm_nexus_prod.db-shm # æœ¬ç•ªç’°å¢ƒWALãƒ•ã‚¡ã‚¤ãƒ«
â””â”€â”€ itsm_nexus_prod.db-wal # æœ¬ç•ªç’°å¢ƒWALãƒ•ã‚¡ã‚¤ãƒ«
```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆ‡ã‚Šæ›¿ãˆã®ä»•çµ„ã¿

`switch-env.sh`ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’ä½¿ç”¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’åˆ‡ã‚Šæ›¿ãˆã¾ã™:

```bash
# é–‹ç™ºç’°å¢ƒã®å ´åˆ
ln -sf itsm_nexus_dev.db backend/itsm_nexus.db

# æœ¬ç•ªç’°å¢ƒã®å ´åˆ
ln -sf itsm_nexus_prod.db backend/itsm_nexus.db
```

### åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

æ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒã‚ã‚‹å ´åˆã€è‡ªå‹•çš„ã«ã‚³ãƒ”ãƒ¼ã•ã‚Œã¾ã™:

```bash
# æ—¢å­˜ã® itsm_nexus.db ãŒå­˜åœ¨ã™ã‚‹å ´åˆ
# â†’ itsm_nexus_dev.db ã¨ itsm_nexus_prod.db ã«ã‚³ãƒ”ãƒ¼
```

### ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—

æœ¬ç•ªç’°å¢ƒã¸ã®åˆ‡ã‚Šæ›¿ãˆæ™‚ã€è‡ªå‹•çš„ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒä½œæˆã•ã‚Œã¾ã™:

```
backups/
â””â”€â”€ itsm_nexus_prod_backup_20260131_120000.db
```

æ‰‹å‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—:

```bash
# npmã‚¹ã‚¯ãƒªãƒ—ãƒˆ
npm run backup

# ç›´æ¥ã‚³ãƒ”ãƒ¼
cp backend/itsm_nexus_prod.db backups/itsm_nexus_prod_$(date +%Y%m%d_%H%M%S).db
```

---

## èª¤æ“ä½œé˜²æ­¢æ©Ÿæ§‹

### 1. ç¢ºèªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ

æœ¬ç•ªç’°å¢ƒã¸ã®åˆ‡ã‚Šæ›¿ãˆã«ã¯ã€æ˜ç¤ºçš„ãªç¢ºèªãŒå¿…è¦ã§ã™:

```
âš ï¸  è­¦å‘Š: æœ¬ç•ªç’°å¢ƒã«åˆ‡ã‚Šæ›¿ãˆã‚ˆã†ã¨ã—ã¦ã„ã¾ã™
æœ¬ç•ªç’°å¢ƒã§ã®æ“ä½œã¯æ…é‡ã«è¡Œã£ã¦ãã ã•ã„
æœ¬ç•ªç’°å¢ƒã«åˆ‡ã‚Šæ›¿ãˆã¾ã™ã‹? (yes/NO):
```

**yes** ã¨å®Œå…¨ã«å…¥åŠ›ã—ãªã„ã¨åˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã›ã‚“ã€‚

### 2. ç’°å¢ƒãƒãƒŠãƒ¼

ç’°å¢ƒã‚¬ãƒ¼ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆ (`env-guard.sh`) ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ç¾åœ¨ã®ç’°å¢ƒãŒè¦–è¦šçš„ã«è¡¨ç¤ºã•ã‚Œã¾ã™:

```bash
# ç’°å¢ƒãƒãƒŠãƒ¼ã‚’è¡¨ç¤º
./scripts/env-guard.sh --show-banner
```

**æœ¬ç•ªç’°å¢ƒã®å ´åˆ:**
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                            â•‘
â•‘    âš ï¸  æœ¬ç•ªç’°å¢ƒ (PRODUCTION MODE) âš ï¸     â•‘
â•‘                                            â•‘
â•‘    ã™ã¹ã¦ã®æ“ä½œã¯æ…é‡ã«è¡Œã£ã¦ãã ã•ã„    â•‘
â•‘                                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### 3. ãƒ‡ãƒ—ãƒ­ã‚¤å‰ãƒã‚§ãƒƒã‚¯

æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã«ã€è¨­å®šã‚’æ¤œè¨¼ã—ã¾ã™:

```bash
./scripts/env-guard.sh --check
```

**ãƒã‚§ãƒƒã‚¯é …ç›®:**
- .envãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨
- å¿…é ˆç’°å¢ƒå¤‰æ•°ã®è¨­å®š
- JWT_SECRETã®å¼·åº¦ï¼ˆæœ¬ç•ªç’°å¢ƒï¼‰
- SSLè¨¼æ˜æ›¸ã®å­˜åœ¨
- node_modulesã®å­˜åœ¨

### 4. ã‚¹ã‚¯ãƒªãƒ—ãƒˆå†…ã§ã®ä½¿ç”¨

ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆãªã©ã§ç’°å¢ƒã‚¬ãƒ¼ãƒ‰ã‚’çµ„ã¿è¾¼ã‚€:

```bash
#!/bin/bash

# ç’°å¢ƒã‚¬ãƒ¼ãƒ‰ã‚’ãƒ­ãƒ¼ãƒ‰
source scripts/env-guard.sh

# æœ¬ç•ªç’°å¢ƒã¸ã®æ“ä½œã‚’ç¢ºèª
if ! check_environment_safety "ãƒ‡ãƒ—ãƒ­ã‚¤"; then
    exit 1
fi

# ãƒ‡ãƒ—ãƒ­ã‚¤å‡¦ç†...
```

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Q1. ç’°å¢ƒã‚’åˆ‡ã‚Šæ›¿ãˆãŸã®ã«å¤ã„ç’°å¢ƒãŒå‹•ã„ã¦ã„ã‚‹

**åŸå› **: systemdã‚µãƒ¼ãƒ“ã‚¹ãŒä»¥å‰ã®ç’°å¢ƒã§èµ·å‹•ã—ãŸã¾ã¾

**è§£æ±ºç­–**:
```bash
# ã™ã¹ã¦ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’ç¢ºèª
sudo systemctl status itsm-sec-nexus-dev
sudo systemctl status itsm-sec-nexus-prod

# ä¸è¦ãªã‚µãƒ¼ãƒ“ã‚¹ã‚’åœæ­¢
sudo systemctl stop itsm-sec-nexus-dev
sudo systemctl stop itsm-sec-nexus-prod

# ç’°å¢ƒã‚’å†è¨­å®šã—ã¦èµ·å‹•
./scripts/switch-env.sh dev
sudo systemctl start itsm-sec-nexus-dev
```

### Q2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‚¨ãƒ©ãƒ¼

**åŸå› **: ç’°å¢ƒåˆ¥ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ãªã„

**è§£æ±ºç­–**:
```bash
# æ—¢å­˜ã®DBã‚’ã‚³ãƒ”ãƒ¼
cp backend/itsm_nexus.db backend/itsm_nexus_dev.db
cp backend/itsm_nexus.db backend/itsm_nexus_prod.db

# ã¾ãŸã¯ç’°å¢ƒã‚’åˆ‡ã‚Šæ›¿ãˆã¦è‡ªå‹•ä½œæˆ
./scripts/switch-env.sh dev
```

### Q3. æœ¬ç•ªç’°å¢ƒè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„

**ã‚¨ãƒ©ãƒ¼**:
```
æœ¬ç•ªç’°å¢ƒè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: config/env/.env.production
```

**è§£æ±ºç­–**:
```bash
# exampleãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼
cp config/env/.env.production.example config/env/.env.production

# æœ¬ç•ªç”¨ã®è¨­å®šã‚’ç·¨é›†
nano config/env/.env.production

# å¿…é ˆé …ç›®:
# - JWT_SECRET (å¼·åŠ›ãªãƒ©ãƒ³ãƒ€ãƒ å€¤)
# - DATABASE_PATH=./backend/itsm_nexus_prod.db
# - CORS_ORIGIN (æœ¬ç•ªãƒ‰ãƒ¡ã‚¤ãƒ³)
```

### Q4. JWT_SECRETãŒå¼±ã„ã¨è­¦å‘Šã•ã‚Œã‚‹

**è­¦å‘Š**:
```
âœ— JWT_SECRETãŒçŸ­ã™ãã¾ã™ (æœ€ä½32æ–‡å­—æ¨å¥¨)
```

**è§£æ±ºç­–**:
```bash
# å¼·åŠ›ãªã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ç”Ÿæˆ
openssl rand -base64 64

# .env.productionã«è¨­å®š
JWT_SECRET=ç”Ÿæˆã•ã‚ŒãŸå€¤ã‚’è²¼ã‚Šä»˜ã‘
```

### Q5. ãƒãƒ¼ãƒˆãŒæ—¢ã«ä½¿ç”¨ä¸­

**ã‚¨ãƒ©ãƒ¼**:
```
Error: listen EADDRINUSE :::5443
```

**è§£æ±ºç­–**:
```bash
# ãƒãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¢ºèª
sudo lsof -i :5443

# ãƒ—ãƒ­ã‚»ã‚¹ã‚’åœæ­¢
sudo systemctl stop itsm-sec-nexus-dev

# ã¾ãŸã¯è©²å½“ãƒ—ãƒ­ã‚»ã‚¹ã‚’kill
sudo kill -9 <PID>
```

### Q6. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ­ãƒƒã‚¯

**ã‚¨ãƒ©ãƒ¼**:
```
SQLITE_BUSY: database is locked
```

**è§£æ±ºç­–**:
```bash
# WALãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ï¼ˆã‚µãƒ¼ãƒ“ã‚¹åœæ­¢å¾Œï¼‰
sudo systemctl stop itsm-sec-nexus-dev
sudo systemctl stop itsm-sec-nexus-prod

rm backend/itsm_nexus.db-shm
rm backend/itsm_nexus.db-wal

# ã‚µãƒ¼ãƒ“ã‚¹ã‚’å†èµ·å‹•
./scripts/switch-env.sh dev
sudo systemctl start itsm-sec-nexus-dev
```

---

## ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. ç’°å¢ƒåˆ‡ã‚Šæ›¿ãˆã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°

```bash
# âœ… æ¨å¥¨: ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢å¾Œã«åˆ‡ã‚Šæ›¿ãˆ
sudo systemctl stop itsm-sec-nexus-dev
./scripts/switch-env.sh prod
sudo systemctl start itsm-sec-nexus-prod

# âŒ éæ¨å¥¨: ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè¡Œä¸­ã®åˆ‡ã‚Šæ›¿ãˆ
# â†’ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã®ç«¶åˆãƒªã‚¹ã‚¯
```

### 2. æœ¬ç•ªç’°å¢ƒã¸ã®ç§»è¡Œãƒ•ãƒ­ãƒ¼

```bash
# 1. é–‹ç™ºç’°å¢ƒã§ãƒ†ã‚¹ãƒˆ
./scripts/switch-env.sh dev
sudo systemctl start itsm-sec-nexus-dev
# ãƒ†ã‚¹ãƒˆå®Ÿæ–½...

# 2. ãƒ†ã‚¹ãƒˆæˆåŠŸå¾Œã€é–‹ç™ºç’°å¢ƒã‚’åœæ­¢
sudo systemctl stop itsm-sec-nexus-dev

# 3. æœ¬ç•ªç’°å¢ƒè¨­å®šã‚’ç¢ºèª
./scripts/env-guard.sh --check

# 4. æœ¬ç•ªç’°å¢ƒã«åˆ‡ã‚Šæ›¿ãˆ
./scripts/switch-env.sh prod

# 5. æœ¬ç•ªç’°å¢ƒã‚’èµ·å‹•
sudo systemctl start itsm-sec-nexus-prod

# 6. å‹•ä½œç¢ºèª
curl -k https://192.168.0.187:6443/api/v1/health
```

### 3. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æˆ¦ç•¥

```bash
# æœ¬ç•ªç’°å¢ƒã¸ã®åˆ‡ã‚Šæ›¿ãˆå‰ï¼ˆè‡ªå‹•ï¼‰
./scripts/switch-env.sh prod
# â†’ è‡ªå‹•çš„ã«backups/ã«ä¿å­˜

# å®šæœŸãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆcronæ¨å¥¨ï¼‰
0 2 * * * cd /path/to/ITSM-System && npm run backup

# é‡è¦ãªå¤‰æ›´å‰ã®æ‰‹å‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
cp backend/itsm_nexus_prod.db backups/before_migration_$(date +%Y%m%d).db
```

### 4. JWT_SECRETç®¡ç†

```bash
# é–‹ç™ºç’°å¢ƒ: å›ºå®šå€¤ã§OK
JWT_SECRET=itsm-nexus-development-secret-key-2026

# æœ¬ç•ªç’°å¢ƒ: ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆå¿…é ˆ
JWT_SECRET=$(openssl rand -base64 64)
```

### 5. ç’°å¢ƒå¤‰æ•°ã®æ¤œè¨¼

```bash
# ç’°å¢ƒåˆ‡ã‚Šæ›¿ãˆå¾Œã«å¿…ãšç¢ºèª
./scripts/env-guard.sh --show-info

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# ç’°å¢ƒ:         production
# HTTPSãƒãƒ¼ãƒˆ:  6443
# DB:           ./backend/itsm_nexus_prod.db
# ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«:   info
```

### 6. ãƒ­ã‚°ã®ç›£è¦–

```bash
# é–‹ç™ºç’°å¢ƒã®ãƒ­ã‚°
sudo journalctl -u itsm-sec-nexus-dev -f

# æœ¬ç•ªç’°å¢ƒã®ãƒ­ã‚°
sudo journalctl -u itsm-sec-nexus-prod -f

# ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ç›´æ¥ç¢ºèª
tail -f logs/development.log
tail -f logs/production.log
```

### 7. ä¸¦è¡Œç¨¼åƒæ™‚ã®æ³¨æ„

é–‹ç™ºç’°å¢ƒã¨æœ¬ç•ªç’°å¢ƒã‚’åŒæ™‚ã«ç¨¼åƒã•ã›ã‚‹å ´åˆ:

```bash
# ãƒãƒ¼ãƒˆãŒé‡è¤‡ã—ãªã„ã“ã¨ã‚’ç¢ºèª
# é–‹ç™º: 5443
# æœ¬ç•ª: 6443, 8080

# ä¸¡æ–¹èµ·å‹•
sudo systemctl start itsm-sec-nexus-dev
sudo systemctl start itsm-sec-nexus-prod

# çŠ¶æ…‹ç¢ºèª
./scripts/switch-env.sh status
```

### 8. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

æœ¬ç•ªç’°å¢ƒé‹ç”¨å‰ã®ç¢ºèªäº‹é …:

- [ ] JWT_SECRETãŒå¼·åŠ›ï¼ˆ64æ–‡å­—ä»¥ä¸Šï¼‰
- [ ] é–‹ç™ºç”¨ã®æ–‡å­—åˆ—ã‚’å«ã¾ãªã„
- [ ] SSLè¨¼æ˜æ›¸ãŒæœ‰åŠ¹
- [ ] CORS_ORIGINãŒæœ¬ç•ªãƒ‰ãƒ¡ã‚¤ãƒ³ã®ã¿
- [ ] LOG_LEVELãŒinfoä»¥ä¸Š
- [ ] DISABLE_SEED_DATA=true
- [ ] Rate LimitingãŒé©åˆ‡
- [ ] ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒå®šæœŸå®Ÿè¡Œã•ã‚Œã‚‹

---

## ã¾ã¨ã‚

ITSM-Sec Nexusã®ç’°å¢ƒåˆ†é›¢ã‚·ã‚¹ãƒ†ãƒ ã¯ã€ä»¥ä¸‹ã‚’å®Ÿç¾ã—ã¾ã™:

1. **å®Œå…¨ãªåˆ†é›¢**: è¨­å®šã€ãƒ‡ãƒ¼ã‚¿ã€ãƒ—ãƒ­ã‚»ã‚¹ãŒç’°å¢ƒã”ã¨ã«ç‹¬ç«‹
2. **å®‰å…¨ãªåˆ‡ã‚Šæ›¿ãˆ**: èª¤æ“ä½œé˜²æ­¢æ©Ÿæ§‹ã«ã‚ˆã‚Šå®‰å¿ƒã—ã¦ç’°å¢ƒã‚’åˆ‡ã‚Šæ›¿ãˆ
3. **è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**: æœ¬ç•ªç’°å¢ƒã¸ã®å¤‰æ›´å‰ã«è‡ªå‹•ä¿è­·
4. **ä¸¦è¡Œç¨¼åƒ**: é–‹ç™ºã¨æœ¬ç•ªã‚’åŒæ™‚ã«å®Ÿè¡Œå¯èƒ½

**ç’°å¢ƒåˆ‡ã‚Šæ›¿ãˆã¯ç°¡å˜ã§ã™:**

```bash
./scripts/switch-env.sh dev   # é–‹ç™ºç’°å¢ƒ
./scripts/switch-env.sh prod  # æœ¬ç•ªç’°å¢ƒ
./scripts/switch-env.sh status # çŠ¶æ…‹ç¢ºèª
```

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€[ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

---

**é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ:**
- `scripts/switch-env.sh` - ç’°å¢ƒåˆ‡ã‚Šæ›¿ãˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- `scripts/env-guard.sh` - ç’°å¢ƒã‚¬ãƒ¼ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- `config/env/.env.development` - é–‹ç™ºç’°å¢ƒè¨­å®š
- `config/env/.env.production` - æœ¬ç•ªç’°å¢ƒè¨­å®š

**æœ€çµ‚æ›´æ–°**: 2026-01-31
